import{r as e}from"./index-SunJDMZF.js";const t=axios.create({baseURL:"http://pcapi-xiaotuxian-front-devtest.itheima.net",timeout:1e4});t.interceptors.request.use((e=>{const t=r().userInfo.token;return t&&(e.headers.Authorization=`Bearer ${t}`),e}),(e=>Promise.reject(e))),t.interceptors.response.use((e=>e.data),(t=>{var a;const s=r();s.userInfo.token;return ElementPlus.ElMessage({message:t.response?t.response.data.message:t.message,type:"warning",plain:!0}),401===(null==(a=t.response)?void 0:a.status)&&(s.clearUserInfo(),e.push("/login")),Promise.reject(t)}));const a=({limit:e=4})=>t({url:"/goods/relevant",params:{limit:e}}),s=Pinia.defineStore("cart",(()=>{const e=r(),a=Vue.computed((()=>e.userInfo.token)),s=Vue.ref([]),u=async()=>{const e=await t({url:"/member/cart"});s.value=e.result},c=Vue.computed((()=>s.value.reduce(((e,t)=>e+t.count),0))),o=Vue.computed((()=>s.value.reduce(((e,t)=>e+t.count*t.price),0))),n=Vue.computed((()=>s.value.reduce(((e,t)=>e+(t.selected?t.count:0)),0))),l=Vue.computed((()=>s.value.reduce(((e,t)=>e+(t.selected?t.count*t.price:0)),0))),d=Vue.computed((()=>s.value.length>0&&s.value.every((e=>e.selected))));return{cartList:s,updateCartList:u,addCart:async e=>{const{skuId:r,count:c}=e;if(a.value)await(({skuId:e,count:a})=>t({url:"/member/cart",method:"POST",data:{skuId:e,count:a}}))({skuId:r,count:c}),await u();else{const t=s.value.find((t=>e.skuId===t.skuId));t?t.count+=e.count:s.value.push(e)}},delCart:async e=>{if(a.value)await(r=[e],t({url:"/member/cart",method:"DELETE",data:{ids:r}})),await u();else{const t=s.value.findIndex((t=>t.skuId===e));s.value.splice(t,1)}var r},clearCart:()=>{s.value=[]},singleCheck:(e,t)=>{s.value.find((t=>t.skuId===e)).selected=t},allCheck:e=>{s.value.forEach((t=>t.selected=e))},allCount:c,allPrice:o,selectedCount:n,selectedPrice:l,isAll:d}}),{persist:!0}),r=Pinia.defineStore("user",(()=>{const e=s(),a=Vue.ref({});return{userInfo:a,getUserInfo:async({account:s,password:r})=>{const u=await(({account:e,password:a})=>t({url:"/login",method:"POST",data:{account:e,password:a}}))({account:s,password:r});var c;a.value=u.result,await(c=e.cartList.map((e=>({skuId:e.skuId,selected:e.selected,count:e.count}))),t({url:"/member/cart/merge",method:"POST",data:c})),await e.updateCartList()},clearUserInfo:()=>{a.value={},e.clearCart()}}}),{persist:!0});export{s as a,a as g,t as h,r as u};
